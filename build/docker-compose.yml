version: '3.9'

services:
    antihero-bot:
        working_dir: /antihero_bot
        build:
            context: ../
            dockerfile: ./build/Dockerfile
        command: python bot_runner.py
        depends_on:
            - antihero-redis
        user: "1000:1000"
        restart: unless-stopped
        container_name: antihero-bot
        env_file: ../.env
        networks:
            antihero:
                aliases:
                    - antihero-bot

    antihero-migrations:
        build:
          context: ../
          dockerfile: ./build/Dockerfile
        command: alembic upgrade head
        user: "1000:1000"
        restart: "no"
        container_name: antihero-migrations
        env_file: ../.env
        networks:
            antihero:
                aliases:
                    - antihero-migrations


    antihero-redis:
        image: "redis"
        container_name: antihero-redis
        volumes:
          - ./redis-data:/data:rw
        restart: unless-stopped
        user: "1000:1000"
        expose:
            - "6379"
        networks:
            antihero:
                aliases:
                    - antihero-redis

networks:
    antihero:
        external: true